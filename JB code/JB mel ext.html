<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>MEL extractor</title>
<style>
    body {
        width:800px;
        font-size: l
    }
    .TranslateButton {
        width: 500px;
        height: 50px;
    }
</style>
<script>
    function ExtractMEL_data()
    {
        var OriginalTextInput = document.getElementById("RawPastedData").value;
        var ReportLines = OriginalTextInput.split("\n")
        var MEL = "";
        var MEL_TestString = "";
        var FoundFirstMEL = false;
        var OutputHTML = "";
        var TextChunk = "";
        var MEL_loc = 0;
        var Chunk_loc = 0;
        var Par_loc = 0;
        var TimeStamp = "";
        var StartOfMEL_section = 0;
        var EndOfMEL_section = ReportLines.length;
        for (var i = 0; i < ReportLines.length; i++)
        {

            MEL_TestString = ReportLines[i].slice(0, 3) + ReportLines[i].slice(4, 9) + ReportLines[i].slice(10, 13) + ReportLines[i].slice(14, 18) + ReportLines[i].slice(19, 25);
            //if (i > 144 && i < 150) {
            //    alert(ReportLines[i].slice(10, 16));
            //}
            if (MEL_TestString == "MELITEMSFORSHIPNUMBER")
            {
                StartOfMEL_section = i;

            }
            if (StartOfMEL_section > 0 && ReportLines[i].slice(10, 16) == "------" && EndOfMEL_section == ReportLines.length)
            {
                if (ReportLines[i-1].trim().length < 2)
                {
                    EndOfMEL_section = i - 2;
                }
                else
                {
                    EndOfMEL_section = i-1;
                }
            }
        }

        for (var i = StartOfMEL_section; i < EndOfMEL_section; i++)
        {
            MEL_TestString = ReportLines[i].slice(2, 3) + ReportLines[i].slice(6, 7) + ReportLines[i].slice(9, 10);
            if (MEL_TestString == " --")
            {
                MEL = ReportLines[i].slice(4, 13).trim();
                FoundFirstMEL = true;
            }
            OutputHTML += ReportLines[i] + "<br />"
            //This puts the button at the end of the MEL by seeing if a new MEL is the next line.
            if (i < ReportLines.length - 1)
            {
                MEL_TestString = ReportLines[i + 1].slice(2, 3) + ReportLines[i + 1].slice(6, 7) + ReportLines[i + 1].slice(9, 10);
            }
            else
            {
                MEL_TestString = " --";
            }
            if (MEL_TestString == " --" && FoundFirstMEL || i == EndOfMEL_section -1)
            {
                //OutputHTML += "  <button onclick=\"CopyTextToClipboard('" + MEL + "')\">Copy to clipboard.</button>" + "<br /><br />";
                OutputHTML += "  <button onclick=\"CopyTextToClipboard('" + MEL + "')\">Copy " + MEL + " to clipboard.</button>" + "<br /><br />";

            }
        }
        document.getElementById("OutputMELsection").innerHTML = OutputHTML;
    }


    function CopyTextToClipboard(TextToCopy) {
        /* This takes text as an input and copies it */
        navigator.clipboard.writeText(TextToCopy);
    }
</script>
</head>
<body>
    <h1>MEL extractor</h1>
    Last updated: 12/23/2022<h2>Overview:</h2>
    <p>This app takes the MEL section of the flight plan and adds buttons so that you can more easily select the MEL, then copy and paste it into AeroDocs search.</p>
    <p>Note that I have another tool that will extract the MEL information from the Ship Tracking section of iCrew. The other tool is meant to get a preview of the MEL information before the flight plan is released and is available at: <a target="_blank" href="https://www.johnfbell.com/Extract_MEL_from_iCrew.html">https://www.johnfbell.com/Extract_MEL_from_iCrew.html</a>.</p>
    <h2>Instructions:</h2>
    <ol>
    <li>Copy the whole MEL section. 
        <ul>
            <li>If you are in Mission+, use the MEL section in Flight Plan Remarks as opposed to the MEL section in Flight Information. The text in the Flight Information section cannot be selected.</li>
            <li>If you have the MiCrew e-mail, open the text file and use the share icon (square with an arrow coming out the top in the upper right) to copy the text.</li>
        </ul>
        </li>
        <li>Paste the text into the box below.</li>
    <li>Use the button to copy the MEL number and paste the MEL number into the search section of AeroDocs.</li>
        <li>You can save this for offline use by using the Reading List feture in Safari. (<a href="https://support.apple.com/en-us/HT200294">link to instructions</a>)</li>
    </ol>
    <h2>Input:</h2>
    <p>
	    <textarea id="RawPastedData" style="width: 750px; height: 100px"></textarea>
	</p>
    <p>
        	    <input id="ExtractDataButton" class="TranslateButton" type="button" value="Extract MEL numbers" onclick="ExtractMEL_data()"/>
    </p>
    <h2>Output:</h2>
    <blockquote>
        <pre>
        <div id="OutputMELsection"></div>
        </pre>
    </blockquote>
    <hr />
    <h3>Cybersecurity statement:</h3>
    <p>This analysis is done within the browser using JavaScript. Nothing travels over the internet. The code is quick and messy, but you can view it by opening this file in Notepad or some other text editor. </p>
    <h3>Copyright:</h3>
    Feel free to use the code in any way you like. This includes copying and modifying the code.
    <h3>Contact info:</h3>
    <p>John Bell DTW330A. I am in iCrew. Feel free to contact me.</p>

</body>
</html>